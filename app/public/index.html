<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Magnus IA - Prédicteur d'Échecs</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="magnus-filters.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // *** CONFIG TAILWIND MISE À JOUR AVEC TOUTES LES COULEURS ***
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        // COULEURS SPÉCIFIQUES AUX CASES D'ÉCHIQUIER
                        'glacial-light': '#e0f2fe',
                        'glacial-dark': '#075985',
                        'boise-light': '#f0d9b5',
                        'boise-dark': '#8b5c46',
                        'nature-light': '#d9f99d',
                        'nature-dark': '#4d7c0f',
                        'lava-light': '#fef3c7',
                        'lava-dark': '#991b1b',
                        'ocean-light': '#bfdbfe',
                        'ocean-dark': '#1e40af',
                        'tropical-light': '#ecfccb',
                        'tropical-dark': '#064e3b',
                        'noir-et-blanc': '#ffffff',
                        'creme': '#fef3c7',
                        'charbon': '#1f2937',

                        // COULEURS TAILWIND STANDARD POUR TEXTE/FILTRES
                        'cyan': {400: '#22d3ee', 700: '#0e7490'},
                        'red': {500: '#ef4444', 900: '#7f1d1d'},
                        'amber': {500: '#f59e0b', 900: '#78350f'},
                        'lime': {300: '#bef264', 400: '#84cc16', 700: '#4d7c0f', 900: '#365314'},
                        'gray': {
                            50: '#f9fafb',
                            200: '#e5e7eb',
                            400: '#9ca3af',
                            500: '#6b7280',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827'
                        },
                        'orange': {500: '#f97316', 600: '#ea580c'},
                        'blue': {400: '#60a5fa', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a'},
                        'emerald': {
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            400: '#34d399',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b'
                        },
                        'fuchsia': {400: '#e879f9', 700: '#a21caf', 900: '#581c87'},
                        'purple': {400: '#c084fc', 600: '#9333ea', 700: '#7e22ce', 900: '#4a044e'},
                        'zinc': {600: '#52525b', 700: '#3f3f46', 900: '#18181b'},
                        'yellow': {800: '#92400e', 950: '#451a03'}
                    }
                }
            }
        }
    </script>
    <style>
        /* Styles pour les icônes d'échecs */
        .piece-icon {
            width: 70%;
            height: 70%;
            image-rendering: crisp-edges;
            transition: filter 0.5s ease;
        }
    </style>
</head>
<body id="body"
      class="flex flex-col justify-center items-center min-h-screen p-4 transition-colors duration-500 font-sans">

<div id="theme-selector-container" class="sticky top-4 right-4 z-10 w-full flex justify-end">
    <div class="flex items-center bg-gray-900/50 p-2 rounded-lg shadow-lg backdrop-blur-sm">
        <label for="theme-select" class="text-white mr-2 text-sm font-semibold">Thème:</label>
        <select id="theme-select" onchange="applyTheme(this.value)"
                class="p-1 rounded bg-gray-700 text-white border border-gray-600 text-sm focus:ring-2 focus:ring-cyan-500">
            <option value="glacial">1. Glacial Minimaliste</option>
            <option value="boise">2. Classique Boisé</option>
            <option value="nature">3. Vert Nature</option>
            <option value="lava">4. Lave et Cendres</option>
            <option value="ocean">5. Océan Profond</option>
            <option value="tropical">6. Forêt Tropicale</option>
            <option value="retrowave">7. RetroWave</option>
            <option value="monochrome">8. Noir & Blanc</option>
            <option value="autumn">9. Automne</option>
            <option value="cyberpunk">10. Cyberpunk</option>
        </select>
    </div>
</div>
<div id="main-card" class="p-8 rounded-xl shadow-2xl max-w-xl w-full border transition-colors duration-500 mb-20">

    <h1 id="title-h1" class="text-4xl text-center font-extrabold mb-2 transition-colors duration-500">Bienvenue sur
        Magnus IA ♟️</h1>
    <h2 id="title-h2" class="text-xl text-center font-semibold mb-8 transition-colors duration-500">Votre IA prédictrice
        d'échecs</h2>

    <div class="flex justify-around w-full mb-10">
        <label class="flex flex-col items-center">
            <p class="text-lg mb-1" id="label-white">Elo du joueur <strong id="strong-white"
                                                                           class="font-bold">BLANC</strong></p>
            <input name="white_elo" type="text" placeholder="Ex: 1500" id="input-white"
                   class="p-2 rounded w-32 text-center transition-colors duration-500"/>
        </label>

        <label class="flex flex-col items-center">
            <p class="text-lg mb-1" id="label-black">Elo du joueur <strong id="strong-black"
                                                                           class="font-bold">NOIR</strong></p>
            <input name="black_elo" type="text" placeholder="Ex: 1500" id="input-black"
                   class="p-2 rounded w-32 text-center transition-colors duration-500"/>
        </label>
    </div>

    <hr id="divider" class="mb-10 transition-colors duration-500"/>

    <h3 id="title-h3" class="lg text-center font-semibold mb-8 transition-colors duration-500">Informations de la
        partie</h3>

    <div class="flex-col justify-around items-center w-full my-10">
        <label class="flex flex-col items-center">
            <p class="text-lg mb-1" id="label-time">Cadence des coups</p>
            <input name="time" type="text" placeholder="Ex: 10+5" id="input-time"
                   class="p-2 rounded w-32 text-center transition-colors duration-500"/>
        </label>
        <div class="flex justify-between w-full my-10">
            <label class="flex flex-col items-center">
                <p class="text-lg text-center mb-1" id="label-ouverture">Ouverture choisie (code)</p>
                <input name="ouverture" type="text" placeholder="Ex: D10" id="input-ouverture"
                       class="p-2 rounded w-32 text-center transition-colors duration-500"/>
            </label>

            <label class="flex flex-col items-center">
                <p class="text-lg text-center mb-1" id="label-num-move">Nombre de coups estimés pour l'ouverture</p>
                <input name="number_of_moves" type="number" placeholder="Ex: 3" id="input-num-move"
                       class="p-2 rounded w-32 text-center transition-colors duration-500"/>
            </label>
        </div>
    </div>

    <hr id="divider-2" class="mb-10 transition-colors duration-500"/>


    <div class="flex justify-center mb-10 rounded-lg">
        <div id="chessboard"
             class="grid grid-cols-8 grid-rows-8 w-96 h-96 border-4 shadow-xl transition-colors duration-500">
        </div>
    </div>

    <div id="result-container" class="text-center mt-6 p-4 rounded-lg hidden transition-all duration-500">
        <p class="text-xl font-semibold" id="prediction-text">
        </p>
    </div>

    <div class="text-center mt-8">
        <button id="predict-button" onclick="predictOutcome()"
                class="font-bold py-3 px-6 rounded-lg shadow-lg transition duration-500">
            Prédire l'Issue
        </button>
    </div>

</div>

<script src="magnus-themes.js"></script>

<script>
    // --- 0. Définition des Chemins d'Accès Locaux (.png) ---
    // NOTE : Ces chemins supposent que vous avez un dossier "Ressources"
    const imagePaths = {
        'Rook': 'Ressources/rook.png',
        'Knight': 'Ressources/knight.png',
        'Bishop': 'Ressources/bishop.png',
        'Queen': 'Ressources/queen.png',
        'King': 'Ressources/king.png',
        'Pawn': 'Ressources/pawn.png'
    };

    const piecesLayout = [
        imagePaths.Rook, imagePaths.Knight, imagePaths.Bishop, imagePaths.Queen, imagePaths.King, imagePaths.Bishop, imagePaths.Knight, imagePaths.Rook
    ];

    // L'objet `themes` est maintenant défini dans magnus-themes.js

    let currentThemeName = 'glacial'; // Thème par défaut

    // --- Logique de prédiction (inchangée) ---
    function predictOutcome() {
        const eloWhite = parseInt(document.getElementById('input-white').value);
        const eloBlack = parseInt(document.getElementById('input-black').value);
        const resultContainer = document.getElementById('result-container');
        const predictionText = document.getElementById('prediction-text');

        if (isNaN(eloWhite) || isNaN(eloBlack) || eloWhite < 0 || eloBlack < 0) {
            predictionText.textContent = "Veuillez entrer des valeurs Elo valides (numériques et positives).";
            resultContainer.classList.remove('hidden');
            return;
        }

        const eloDiff = eloWhite - eloBlack;
        const expectedScore = 1 / (1 + Math.pow(10, -eloDiff / 400));

        let prediction = "";

        if (expectedScore >= 0.65) {
            prediction = `Victoire des BLANCS. (Probabilité estimée: ${(expectedScore * 100).toFixed(1)}%)`;
        } else if (expectedScore <= 0.35) {
            prediction = `Victoire des NOIRS. (Probabilité estimée: ${((1 - expectedScore) * 100).toFixed(1)}% pour NOIR)`;
        } else {
            prediction = `Match serré, probabilité de NULLE élevée. (Score attendu: ${(expectedScore).toFixed(2)})`;
        }

        predictionText.textContent = prediction;
        resultContainer.classList.remove('hidden');
    }

    // --- 2. Génération de l'Échiquier (inchangée) ---
    function generateChessboard(themeData) {
        const board = document.getElementById('chessboard');
        board.innerHTML = '';
        board.classList.add('border-gray-900');

        for (let i = 0; i < 64; i++) {
            const row = Math.floor(i / 8);
            const col = i % 8;
            const isDark = (row + col) % 2 === 1;
            const cell = document.createElement('div');

            cell.className = isDark ? themeData.darkSquare : themeData.lightSquare;
            cell.classList.add('transition-colors', 'duration-500', 'flex', 'justify-center', 'items-center');

            let piecePath = '';
            let pieceFilterClass = '';

            if (row === 7 || row === 6) {
                piecePath = (row === 7) ? piecesLayout[col] : imagePaths.Pawn;
                pieceFilterClass = themeData.pieceFilterClassWhite;
            } else if (row === 1 || row === 0) {
                piecePath = (row === 0) ? piecesLayout[col] : imagePaths.Pawn;
                pieceFilterClass = themeData.pieceFilterClassBlack;
            }

            if (piecePath) {
                const pieceElement = document.createElement('img');
                pieceElement.src = piecePath;
                pieceElement.alt = "Pièce d'échecs";
                pieceElement.className = `piece-icon ${pieceFilterClass}`;
                pieceElement.style.filter = '';
                cell.appendChild(pieceElement);
            }

            board.appendChild(cell);
        }
    }

    // --- Fonction d'Application du Thème (inchangée) ---
    function applyTheme(themeName) {
        // L'objet 'themes' est disponible car magnus-themes.js a été chargé
        const theme = themes[themeName];
        if (!theme) return;

        currentThemeName = themeName;

        const whiteStrong = document.getElementById('strong-white');
        const blackStrong = document.getElementById('strong-black');
        const resultContainer = document.getElementById('result-container');

        // Nettoyage des anciennes classes de couleur forte (TEXTE)
        Object.values(themes).forEach(t => {
            whiteStrong.classList.remove(t.strongTextColorWhite);
            blackStrong.classList.remove(t.strongTextColorBlack);
            if (t.result) resultContainer.classList.remove(...t.result.split(' '), 'border');
        });

        // Application des nouvelles classes de couleur forte (TEXTE)
        whiteStrong.classList.add(theme.strongTextColorWhite);
        blackStrong.classList.add(theme.strongTextColorBlack);
        resultContainer.classList.add(...theme.result.split(' '), 'border');

        const elements = [
            {id: 'body', classes: theme.body, reset: true},
            {id: 'main-card', classes: theme.card, reset: true},
            {id: 'title-h1', classes: theme.title, reset: true},
            {id: 'title-h2', classes: theme.title, reset: true},
            {id: 'title-h3', classes: theme.title, reset: true},
            {id: 'label-white', classes: theme.plainText, reset: true},
            {id: 'label-black', classes: theme.plainText, reset: true},
            {id: 'label-time', classes: theme.plainText, reset: true},
            {id: 'label-ouverture', classes: theme.plainText, reset: true},
            {id: 'label-num-move', classes: theme.plainText, reset: true},
            {id: 'divider', classes: theme.divider, reset: true},
            {id: 'divider-2', classes: theme.divider, reset: true},
            {id: 'predict-button', classes: theme.button, reset: true},
            {
                id: 'input-white',
                classes: `${theme.inputBase} focus:outline-none focus:ring-2 ${theme.focusRing} focus:ring-opacity-75`,
                reset: true
            },
            {
                id: 'input-black',
                classes: `${theme.inputBase} focus:outline-none focus:ring-2 ${theme.focusRing} focus:ring-opacity-75`,
                reset: true
            },
            {
                id: 'input-time',
                classes: `${theme.inputBase} focus:outline-none focus:ring-2 ${theme.focusRing} focus:ring-opacity-75`,
                reset: true
            },
            {
                id: 'input-ouverture',
                classes: `${theme.inputBase} focus:outline-none focus:ring-2 ${theme.focusRing} focus:ring-opacity-75`,
                reset: true
            },
            {
                id: 'input-num-move',
                classes: `${theme.inputBase} focus:outline-none focus:ring-2 ${theme.focusRing} focus:ring-opacity-75`,
                reset: true
            },

        ];

        elements.forEach(elData => {
            const el = document.getElementById(elData.id);
            if (el) {
                // Logique de nettoyage
                Object.values(themes).forEach(t => {
                    let classesToClear = [t.body, t.card, t.title, t.plainText, t.divider, t.button];
                    if (elData.id.startsWith('input-')) {
                        classesToClear.push(t.inputBase, t.focusRing, 'focus:outline-none', 'focus:ring-2', 'focus:ring-opacity-75');
                    }
                    classesToClear.forEach(classString => {
                        el.classList.remove(...classString.split(' '));
                    });
                });

                el.classList.add(...elData.classes.split(' '));

                if (el.tagName === 'INPUT' || el.tagName === 'BUTTON' || el.tagName === 'HR') {
                    el.classList.add('transition-colors', 'duration-500');
                }
            }
        });

        // Régénérer l'échiquier avec la coloration stable
        generateChessboard(theme);

        const selectEl = document.getElementById('theme-select');
        // Nettoyage des focus rings sur le sélecteur
        Object.values(themes).forEach(t => selectEl.classList.remove(t.focusRing.replace('focus:', '')));
        selectEl.classList.add(theme.focusRing.replace('focus:', ''));
    }

    document.addEventListener('DOMContentLoaded', () => {
        applyTheme(document.getElementById('theme-select').value);
    });

</script>
</body>
</html>